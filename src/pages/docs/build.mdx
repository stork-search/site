import { SetPreferenceOnClick, When } from "@/components/docs/DocsPreferences";

# Build a Search Index

To start using Stork, you need to build a **search index**: a file that Stork can load to respond to search queries. To build a search index, you need to give Stork a **configuration file** that tells Stork all the documents you want indexed, along with some metadata about how to index those documents.

## The Configuration File

A Stork configuration file describes all the documents that should be indexed. This configuration file can either be written in <SetPreferenceOnClick name="config-format" value="json">JSON</SetPreferenceOnClick> or <SetPreferenceOnClick name="config-format" value="toml">TOML</SetPreferenceOnClick>.

Stork can read contents from <SetPreferenceOnClick name="document-source" value="web">the web</SetPreferenceOnClick>, from <SetPreferenceOnClick name="document-source" value="filesystem">the filesystem</SetPreferenceOnClick>, or from <SetPreferenceOnClick name="document-source" value="inline">inline within the configuration file</SetPreferenceOnClick>.

<When prefset={{"config-format": "toml", "document-source": "web"}}>

```toml[data-filename="basic.toml"]
[[input.files]]
title = "1: General Introduction"
url = "https://federalist.stork-search.net/1.html"

[[input.files]]
title = "2-5: Concerning Dangers from Foreign Force and Influence"
url = "https://federalist.stork-search.net/2-5.html"

[[input.files]]
title = "6-7: Concerning Dangers from Dissentions Between the States"
url = "https://federalist.stork-search.net/6-7.html"

```

</When>

<When prefset={{"config-format": "toml", "document-source": "inline"}}>

```toml[data-filename="basic.toml"]
[[input.files]]
title = "1: General Introduction"
contents = "After an unequivocal experience of the inefficiency of the subsisting federal government, you are called upon to deliberate on a new Constitution for the United States of America..."
url = "https://federalist.stork-search.net/1.html"

[[input.files]]
title = "2-5: Concerning Dangers from Foreign Force and Influence"
contents = "When the people of America reflect that they are now called upon to decide a question, which, in its consequences, must prove one of the most important that ever engaged their attention..."
url = "https://federalist.stork-search.net/2-5.html"

[[input.files]]
title = "6-7: Concerning Dangers from Dissentions Between the States"
contents = "The three last numbers of this paper have been dedicated to an enumeration of the dangers to which we should be exposed, in a state of disunion, from the arms and arts of foreign nations..."
url = "https://federalist.stork-search.net/6-7.html"

```

</When>

<When prefset={{"config-format": "toml", "document-source": "filesystem"}}>

```toml[data-filename="basic.toml"]
[[input.files]]
path = "general-introduction.txt"
title = "1: General Introduction"
url = "https://federalist.stork-search.net/1.html"

[[input.files]]
path = "foreign-force.txt"
title = "2-5: Concerning Dangers from Foreign Force and Influence"
url = "https://federalist.stork-search.net/2-5.html"

[[input.files]]
path = "dissentions-between-states.txt"
title = "6-7: Concerning Dangers from Dissentions Between the States"
url = "https://federalist.stork-search.net/6-7.html"
```

</When>

<When prefset={{"config-format": "json", "document-source": "web"}}>

```json[data-filename="basic.json"]
{
  "input": {
    "files": [
      {
        "title": "1: General Introduction",
        "url": "https://federalist.stork-search.net/1.html"
      },
      {
        "title": "2-5: Concerning Dangers from Foreign Force and Influence",
        "url": "https://federalist.stork-search.net/2-5.html"
      },
      {
        "title": "6-7: Concerning Dangers from Dissentions Between the States",
        "url": "https://federalist.stork-search.net/6-7.html"
      }
    ]
  }
}
```

</When>

<When prefset={{"config-format": "json", "document-source": "inline"}}>

```json[data-filename="basic.json"]
{
  "input": {
    "files": [
      {
        "title": "1: General Introduction",
        "contents": "After an unequivocal experience of the inefficiency of the subsisting federal government, you are called upon to deliberate on a new Constitution for the United States of America..."
        "url": "https://federalist.stork-search.net/1.html"
      },
      {
        "title": "2-5: Concerning Dangers from Foreign Force and Influence",
        "contents": "When the people of America reflect that they are now called upon to decide a question, which, in its consequences, must prove one of the most important that ever engaged their attention..."
        "url": "https://federalist.stork-search.net/2-5.html"
      },
      {
        "title": "6-7: Concerning Dangers from Dissentions Between the States",
        "contents": "The three last numbers of this paper have been dedicated to an enumeration of the dangers to which we should be exposed, in a state of disunion, from the arms and arts of foreign nations..."
        "url": "https://federalist.stork-search.net/6-7.html"
      }
    ]
  }
}
```

</When>

<When prefset={{"config-format": "json", "document-source": "filesystem"}}>

```json[data-filename="basic.json"]
{
  "input": {
    "files": [
      {
        "path": "general-introduction.txt",
        "title": "1: General Introduction",
        "url": "https://federalist.stork-search.net/1.html"
      },
      {
        "path": "foreign-force.txt",
        "title": "2-5: Concerning Dangers from Foreign Force and Influence",
        "url": "https://federalist.stork-search.net/2-5.html"
      },
      {
        "path": "dissentions-between-states.txt",
        "title": "6-7: Concerning Dangers from Dissentions Between the States",
        "url": "https://federalist.stork-search.net/6-7.html"
      }
    ]
  }
}
```

</When>

<When name="document-source" value="filesystem">

When Stork is looking for files on the filesystem, you can define a **base directory** to which all the specified paths are relative. This base directory configuration is part of the input config:

<When name="config-format" value="toml" borderless>

```toml
[input]
base_directory = "my_files"

[[input.files]]
path = "general-introduction.txt"
# ...
```

</When>

<When name="config-format" value="json" borderless>

```json
{
  "input": {
    "base_directory": "my_files"
    "files": [
      {
        "path": "general-introduction.txt",
        // ...
      },
      // ...
    ]
  }
}
```

</When>

All file paths in the configuration file, including the base directory, are relative to the **working directory when you run the Stork command**. For example, if you're in the `~/project/` directory when you run `stork build`, Stork will look for the files at:

- `~/project/my_files/federalist-1.txt`
- `~/project/my_files/federalist-2.txt`
- `~/project/my_files/federalist-3.txt`

</When>

To build a search index from this configuration file, save the file to disk and pass it into the Stork command-line tool:

<When name="config-format" value="toml">

```sh
$ stork build --input basic.toml --output federalist.st
```

</When>

<When name="config-format" value="json">

```sh
$ stork build --input basic.json --output federalist.st
```

</When>

## Testing your index

After writing a config file, you might want to test how well the search interface works before loading it onto your web site. Stork offers a test mode, where it will build your search index and load it into a simplified web interface so you can play with the search functionality while iterating on your configuration.

To test out your index, run:

```sh
$ stork test --index my-index.st
```

and open `http://localhost:1612`, the web page served by Stork.

## File Formats

Today, Stork can automatically recognize and extract text from four types of files:

1. Plain text files,
2. [SRT subtitle files](/docs/srt),
3. [HTML files](/docs/html), and
4. Markdown files.

Stork will automatically detect the file format by inspecting its file extension; however, if your file extension is non-standard (such as `.mdx` for a Markdown file), you can specify the format of any file in the configuration:

<When name="config-format" value="toml">

```toml
[[input.files]]
path = "federalist-1.mdx"
title = "1: General Introduction"
url = "https://federalist.stork-search.net/1.html"
filetype = "Markdown"
```

</When>

<When name="config-format" value="json">

```json
{
  "input": {
    "files": [
      {
        "path": "federalist-1.mdx",
        "title": "1: General Introduction",
        "url": "https://federalist.stork-search.net/1.html",
        "filetype": "Markdown"
      }
      // ...
    ]
  }
}
```

</When>

## Additional Options

You can visit the [Configuration File Reference](/docs/config-ref) to see the full list of acceptable configuration key-value pairs.

The Stork configuration file lets you control many aspects of how Stork indexes your content and how the search interface behaves, such as:

- How frontmatter in a document should be parsed
- Which HTML selectors in an HTML document should be indexed and which should be ignored
- Which language the stemmer uses to stem each word in your corpus

## Next steps

- [See the complete Configuration File reference →](/docs/config-ref)
- [Learn how to embed the web interface on your site →](/docs/interface)
